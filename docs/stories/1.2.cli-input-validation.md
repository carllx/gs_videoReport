# Story 1.2: 命令行接口与输入验证

## Status

**✅ Completed** (MVP实现完成)

## Story

**As a** 艺术领域教师,
**I want** 通过命令行界面传入YouTube视频链接并获得清晰的输入验证反馈,
**so that** 我能快速启动视频分析流程并确保输入的正确性

## Acceptance Criteria

1. 应用程序能接受一个 URL 作为命令行参数
2. 当传入一个有效的 YouTube URL 时，程序能够识别并继续执行
3. 当传入一个无效或非 YouTube URL 时，程序会退出并显示清晰的错误提示
4. 当没有传入 URL 时，程序会显示帮助信息，说明正确的用法
5. 支持常见的 YouTube URL 格式（youtube.com, youtu.be, m.youtube.com）
6. 提供 `--help` 和 `--version` 基础命令选项
7. 支持 `--template` 选项指定使用的提示词模板类型
8. 支持 `--list-templates` 选项显示所有可用的模板类型

## Tasks / Subtasks

- [ ] 设计命令行参数结构 (AC: 1)
  - [ ] 使用 Typer 框架创建基础 CLI 应用
  - [ ] 定义主要命令和参数接口
  - [ ] 添加全局选项（help, version, verbose 等）

- [ ] 实现 YouTube URL 验证逻辑 (AC: 2, 3, 5)
  - [ ] 创建 URL 格式验证正则表达式
  - [ ] 支持多种 YouTube URL 格式识别
  - [ ] 实现视频ID提取功能
  - [ ] 添加URL可访问性验证

- [ ] 构建用户友好的错误处理 (AC: 3, 4)
  - [ ] 设计清晰的错误消息模板
  - [ ] 实现不同错误类型的分类处理
  - [ ] 创建帮助文档自动生成
  - [ ] 添加使用示例和常见问题说明

- [ ] 实现基础命令选项 (AC: 6, 7, 8)
  - [ ] 添加 `--version` 显示应用版本信息
  - [ ] 实现 `--help` 显示详细使用说明
  - [ ] 添加 `--verbose` 详细输出模式
  - [ ] 创建配置文件路径指定选项
  - [ ] 添加 `--template` 选项支持模板类型选择 (AC: 7)
  - [ ] 实现 `--list-templates` 显示所有可用模板 (AC: 8)

- [ ] 输入预处理和标准化 (AC: 1, 2)
  - [ ] URL 格式标准化处理
  - [ ] 移除URL中的多余参数
  - [ ] 提取核心视频标识符
  - [ ] 验证视频可访问性

## Dev Notes

**项目技术背景:**

- 基于 Typer 框架构建现代化 CLI 应用
- 需要处理多种 YouTube URL 格式
- 错误处理要求用户友好且信息丰富
- 为后续API调用做好数据预处理

**架构要求:**

- 模块化设计，CLI逻辑独立于业务逻辑
- 可扩展的参数系统，便于后续功能添加
- 统一的错误处理机制
- 支持配置文件和命令行参数组合

**关键技术点:**

- Typer CLI 框架集成和配置
- YouTube URL 正则表达式匹配和验证
- 用户输入预处理和标准化
- 错误分类和用户友好提示

**具体技术实现要求:**

- CLI 框架：`typer ^0.12.0`
- URL 验证：使用正则表达式 + requests 验证可访问性
- 错误处理：分层错误处理机制
- 配置管理：支持 `config.yaml` 与命令行参数结合
- 输出格式：标准化JSON/文本输出格式

**URL格式支持要求:**

```python
# 支持的YouTube URL格式
youtube_patterns = [
    r'https?://(?:www\.)?youtube\.com/watch\?v=([a-zA-Z0-9_-]{11})',
    r'https?://(?:www\.)?youtu\.be/([a-zA-Z0-9_-]{11})',
    r'https?://(?:m\.)?youtube\.com/watch\?v=([a-zA-Z0-9_-]{11})',
]
```

### Testing

**测试标准:**

- 单元测试覆盖 URL 验证逻辑
- CLI 参数解析和验证测试
- 错误处理场景测试（无效URL、网络错误等）
- 多种 YouTube URL 格式兼容性测试
- 帮助文档生成和显示测试
- 测试文件位置：`tests/test_cli.py`
- 使用 pytest 和 typer.testing.CliRunner
- Mock 网络请求避免实际HTTP调用

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation for CLI and input validation functionality | Sarah (PO) |
| 2025-01-27 | 1.1 | Added template selection CLI options - --template and --list-templates support | Sarah (PO) |
| 2025-01-27 | 1.2 | Fixed AC reference numbering in Tasks/Subtasks after adding new acceptance criteria | Sarah (PO) |

## Dev Agent Record

This section will be populated by the development agent during implementation

### Agent Model Used

To be filled by dev agent

### Debug Log References

To be filled by dev agent

### Completion Notes List

To be filled by dev agent

### File List

To be filled by dev agent

## QA Results

Results from QA Agent review will be populated here
