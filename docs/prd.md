# gs_videoReport 产品需求文档 (PRD)

## 1. 目标与背景 (Goals and Background Context)

### 目标 (Goals)

- **(MVP 目标)** 交付一个功能稳定、能融入您个人工作流的命令行工具，实现将本地视频文件高效转化为结构化的 Markdown 教案。聚焦核心AI分析价值，为后续YouTube集成奠定基础。
    
- **(学习目标)** 验证 AI 辅助备课的核心价值，为后续开发（第二阶段的批量处理、第三阶段的幻灯片生成）奠定坚实基础。
    

### 背景 (Background Context)

本项目旨在解决教师（尤其是在艺术和媒体领域）在将视频内容转化为教学材料时所面临的耗时、低效的手动操作问题。现有的工作流程通常是割裂的。`gs_videoReport` MVP 将作为一个在 macOS 终端运行的 AI 助教，通过提供一个从本地视频文件到成品教案的端到端自动化解决方案，来解决这一核心痛点。

### 变更日志 (Change Log)

|   |   |   |   |
|---|---|---|---|
|**日期**|**版本**|**描述**|**作者**|
|2025-08-17|1.0|基于《项目简报》与《架构文档》创建|John (PM)|

## 2. 需求 (Requirements)

### 功能需求 (Functional Requirements)

1. **FR1**: 系统必须能通过命令行参数，接收一个有效的本地视频文件路径作为输入。
    
2. **FR2**: 系统必须能识别无效的文件路径、不支持的视频格式，并向用户返回清晰、友好的错误提示。
    
3. **FR3**: 系统必须调用 Google Gemini API 对指定的本地视频文件内容进行分析。
    
4. **FR4**: 系统必须基于分析结果，生成一份 Markdown (`.md`) 格式的综合性教案文件。
    
5. **FR5**: 生成的教案文件中必须包含精确的时间戳，格式化为标准时间表示 (MM:SS)。
    
6. **FR6**: 系统必须将生成的 `.md` 文件保存到用户本地文件系统的一个可配置路径下。

7. **FR7**: 系统必须支持灵活的API密钥管理，优先级为：CLI参数 > 环境变量 > 配置文件。

8. **FR8**: 系统必须支持自定义提示模板选择，特别是`chinese_transcript`模板以满足中文用户需求。

9. **FR9**: 系统必须支持多种Gemini模型选择，包括成本优化的选项。

10. **FR10**: 系统必须支持OAuth 2.0认证以访问需要特殊权限的API功能。

11. **FR11**: 系统必须支持动态并行处理，根据可用API密钥数量自动调整worker数量(1-8个)。

12. **FR12**: 系统必须实现专用Worker池架构，每个API密钥绑定一个专用worker，防止任务冲突。

13. **FR13**: 系统必须支持断点续传功能，自动跳过已处理的视频文件，节省API配额。

14. **FR14**: 系统必须按模板创建子文件夹结构，如`test_output/chinese_transcript/`。
    

### 非功能需求 (Non-Functional Requirements)

1. **NFR1**: 应用程序必须是一个能在 macOS 终端环境中稳定运行的命令行工具 (CLI)。
    
2. **NFR2**: 对于一个10分钟时长的标准视频，在正常网络条件下，端到端的处理时间应少于5分钟。
    
3. **NFR3**: 用户的 Google API 密钥必须通过多种安全方式管理（CLI参数、环境变量、配置文件），实现灵活性与安全性的平衡，不得硬编码在程序中。
    
4. **NFR4**: 工具在执行时，必须在终端提供清晰的、分阶段的实时进度反馈（例如，“正在分析视频...”，“正在生成教案...”）。
    
5. **NFR5**: 输出的 Markdown 文件必须包含与 Obsidian Dataview 插件兼容的元数据 (YAML Frontmatter)，以支持后续的自动化处理。
    
6. **NFR6**: **长视频处理机制**: 为防止因视频过长导致超出 API 的 Token 限制，系统必须提供文件大小限制和压缩选项，确保处理效率。

7. **NFR7**: **多模型支持**: 系统必须支持不同的Gemini模型选择，允许用户根据需求和成本考虑选择最适合的模型。

8. **NFR8**: **认证灵活性**: 系统必须支持多种认证方式（API Key、OAuth），适应不同的使用场景和安全要求。

9. **NFR9**: **动态并发控制**: 系统必须根据API密钥数量动态调整并发数，最少1个最多8个worker，确保资源高效利用。

10. **NFR10**: **任务隔离性**: 每个worker必须独立处理任务，互不干扰，确保处理的原子性和一致性。

11. **NFR11**: **用户体验优化**: 控制台输出必须使用清晰的颜色方案，只有转录成功才显示绿色，其他状态使用不同颜色区分。

12. **NFR12**: **断点续传效率**: 系统必须在启动时快速检查已完成的任务，避免重复处理，大幅节省处理时间和API配额。
    

## 3. 技术假设 (Technical Assumptions)

### 仓库结构 (Repository Structure)

- **单一仓库 (Single Repository)**: 整个项目代码将存放在一个独立的 Git 仓库中。
    

### 服务架构 (Service Architecture)

- **客户端-服务端架构**: 本工具作为一个本地**客户端 (Client)**，其核心逻辑是直接与外部的 **Google Gemini API (Server)** 进行交互。项目本身不包含需要部署的后端服务或微服务。
    

### 测试要求 (Testing Requirements)

- **单元测试 + 集成测试**:
    
    - **单元测试**: 需要对所有核心的、无外部依赖的函数（例如：URL 格式验证、配置文件加载等）编写独立的单元测试。
        
    - **集成测试**: 需要验证与 Google Gemini API 的实际交互流程，包括请求的正确构建和响应的有效处理。
        

### 其他技术假设 (Additional Technical Assumptions)

- **编程语言**: 采用 **Python** 作为主要开发语言。
    
- **核心依赖**: 项目的成功强依赖于 Google Gemini API 的功能、接口稳定性和响应质量。
    
- **配置管理**: API 密钥等敏感信息将通过项目根目录下的外部配置文件进行管理，以确保安全与灵活性。
    

## 4. 史诗列表 (Epic List)

- **史诗 1: 核心视频转教案引擎 (MVP)**
    
    - **目标**: 交付一个功能性的命令行工具，该工具能成功处理单个 YouTube 视频，并生成一份包含精确时间戳的高质量、结构化 Markdown 教案。
        

## 5. 史诗 1: 核心视频转教案引擎 (MVP)

**目标**: 交付一个功能性的命令行工具，该工具能成功处理单个 YouTube 视频，并生成一份包含精确时间戳的高质量、结构化 Markdown 教案。

### 故事 1.1: 项目初始化与配置加载

- **作为一个用户**，我希望能初始化项目并安全地配置我的 API 密钥，**以便** 应用程序为后续开发做好准备，并能成功地进行服务认证。
    
- **验收标准**:
    
    1. 项目基础结构已创建（例如，包含 `pyproject.toml` 用于依赖管理）。
        
    2. 应用程序可以成功地从外部配置文件（如 `config.yaml`）中读取 Google API 密钥。
        
    3. 一个基础的 CLI 命令（如 `gs_videoReport --version`）能够成功运行，证明环境设置无误。
        

### 故事 1.2: 命令行接口与输入验证

- **作为一个用户**，我希望能在命令行中通过参数传入一个本地视频文件路径，**以便** 启动视频分析流程。
    
- **验收标准**:
    
    1. 应用程序能接受一个本地视频文件路径作为命令行参数（满足 **FR1**）。
        
    2. 当传入一个有效的视频文件路径时，程序能够识别并继续执行。
        
    3. 当传入一个无效的文件路径或不支持的视频格式时，程序会退出并显示清晰的错误提示（满足 **FR2**）。
        
    4. 当没有传入文件路径时，程序会显示帮助信息，说明正确的用法。
        

### 故事 1.3: API 交互与核心内容分析

- **作为一个用户**，我希望应用程序能将我提供的本地视频文件上传到 Google Gemini API，**以便** 对视频内容进行核心分析。
    
- **验收标准**:
    
    1. 给定一个有效的本地视频文件，应用程序能成功地向 Google Gemini API 发起分析请求（满足 **FR3**）。
        
    2. 应用程序能成功接收并解析 API 的响应。
        
    3. 在 API 调用期间，终端会显示实时进度状态，告知用户当前进展（满足 **NFR4**）。
        
    4. 如果 API 返回错误（如密钥无效、超额），程序能捕获并向用户显示友好的错误信息。
        

### 故事 1.4: 教案格式化与文件输出

- **作为一个用户**，我希望分析后的内容能被格式化成结构化的 Markdown 教案并保存到本地，**以便** 我能获得一个最终可用的文件。
    
- **验收标准**:
    
    1. API 返回的内容被正确地填入一个标准的 Markdown 教案模板中（满足 **FR4**）。
        
    2. 生成的教案中包含了基于分析的、精确的时间戳信息（满足 **FR5**）。
        
    3. Markdown 文件的顶部包含了与 Obsidian Dataview 兼容的元数据（YAML Frontmatter）（满足 **NFR5**）。
        
    4. 最终的 `.md` 文件被成功保存到本地文件系统（满足 **FR6**）。
        
    5. 用户可以通过命令行参数指定文件的输出路径。
        
    6. 程序成功执行后，会在终端显示成功信息及产出文件的路径。
        

## 6. 清单检查结果报告 (Checklist Results Report)

在对本 PRD 进行内部审查后，我确认：

- **问题定义与背景**: 清晰、明确，与《项目简报》完全对齐。
    
- **MVP 范围定义**: 范围聚焦，所有需求都直接服务于 MVP 目标。
    
- **功能与非功能需求**: 需求明确、可测试，并考虑到了关键的技术限制（如 Obsidian 兼容性、长视频处理）。
    
- **史诗与故事结构**: 史诗定义清晰，用户故事按逻辑顺序分解，大小适中，适合开发。
    

**结论**: 本 PRD 已达到高质量标准，内容完整、逻辑严谨，可以作为下一阶段架构设计的可靠输入。

## 7. 下一步 (Next Steps)

### 致架构师 (Architect) 的提示

这份《产品需求文档》为 `gs_videoReport` 项目的 MVP 版本定义了清晰的需求和范围。请您基于此文档，开始进行详细的技术架构设计。

在设计时，请重点关注以下几个方面：

1. **技术选型**: 确认 Python 生态中用于处理 YouTube 视频、调用 API 和构建 CLI 的最佳库组合。
    
2. **核心流程设计**: 设计一个健壮、可重试的流程来处理视频分析，特别是要考虑到 **NFR6** 中提到的长视频处理机制。
    
3. **配置与输出**: 设计灵活的配置管理方案和模块化的文件输出系统，确保 **NFR5** 中提到的 Obsidian 兼容性得到完美实现。